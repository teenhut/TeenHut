{"version":3,"sources":["../../../../app/hypes/%5Bid%5D/page.tsx","../../../../components/feed/HypeFeed.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useParams } from \"next/navigation\";\r\nimport HypeFeed from \"@/components/feed/HypeFeed\";\r\n\r\nexport default function SingleHypePage() {\r\n  const { id } = useParams();\r\n\r\n  return (\r\n    <main>\r\n      <HypeFeed initialHypeId={id as string} />\r\n    </main>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { useState, useEffect, useRef } from \"react\";\r\nimport ReelCard from \"@/components/feed/ReelCard\";\r\nimport UploadModal from \"@/components/upload/UploadModal\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Upload } from \"lucide-react\";\r\nimport { useAuth } from \"@/context/AuthContext\";\r\n\r\ninterface Hype {\r\n  _id: string;\r\n  title: string;\r\n  author: string;\r\n  mediaUrl: string;\r\n  mediaType: \"image\" | \"video\";\r\n  xp: number;\r\n  likes: number;\r\n  isLiked: boolean;\r\n  comments: any[];\r\n  creatorId: string; // Added creatorId\r\n}\r\n\r\ninterface HypeFeedProps {\r\n  initialHypeId?: string;\r\n}\r\n\r\nexport default function HypeFeed({ initialHypeId }: HypeFeedProps) {\r\n  const [hypes, setHypes] = useState<Hype[]>([]);\r\n  const [showUploadModal, setShowUploadModal] = useState(false);\r\n  const [activeHypeId, setActiveHypeId] = useState<string | null>(\r\n    initialHypeId || null\r\n  );\r\n  const [isGlobalMuted, setIsGlobalMuted] = useState(true);\r\n  const observer = useRef<IntersectionObserver | null>(null);\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const { user } = useAuth();\r\n  const [hasScrolledToInitial, setHasScrolledToInitial] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchHypes();\r\n  }, [user]);\r\n\r\n  const fetchHypes = async () => {\r\n    try {\r\n      const res = await fetch(`/api/hypes?userId=${user?.id || \"\"}`);\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        setHypes(data);\r\n        if (data.length > 0 && !activeHypeId) {\r\n          setActiveHypeId(data[0]._id);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Failed to fetch hypes\", error);\r\n    }\r\n  };\r\n\r\n  // Scroll to initial hype\r\n  useEffect(() => {\r\n    if (\r\n      initialHypeId &&\r\n      hypes.length > 0 &&\r\n      !hasScrolledToInitial &&\r\n      containerRef.current\r\n    ) {\r\n      const element = containerRef.current.querySelector(\r\n        `[data-id=\"${initialHypeId}\"]`\r\n      );\r\n      if (element) {\r\n        element.scrollIntoView({ behavior: \"auto\" });\r\n        setHasScrolledToInitial(true);\r\n        setActiveHypeId(initialHypeId);\r\n      }\r\n    }\r\n  }, [initialHypeId, hypes, hasScrolledToInitial]);\r\n\r\n  // Scroll Observer\r\n  useEffect(() => {\r\n    if (hypes.length === 0) return;\r\n\r\n    const options = {\r\n      root: containerRef.current, // Use the container as root\r\n      rootMargin: \"0px\",\r\n      threshold: 0.6, // 60% visibility required\r\n    };\r\n\r\n    observer.current = new IntersectionObserver((entries) => {\r\n      entries.forEach((entry) => {\r\n        if (entry.isIntersecting) {\r\n          const id = entry.target.getAttribute(\"data-id\");\r\n          if (id && id !== activeHypeId) {\r\n            setActiveHypeId(id);\r\n            // Update URL without reloading\r\n            window.history.replaceState(null, \"\", `/hypes/${id}`);\r\n          }\r\n        }\r\n      });\r\n    }, options);\r\n\r\n    // Observe all hype cards\r\n    const cards = containerRef.current?.querySelectorAll(\".hype-card\");\r\n    cards?.forEach((card) => {\r\n      observer.current?.observe(card);\r\n    });\r\n\r\n    return () => {\r\n      if (observer.current) {\r\n        observer.current.disconnect();\r\n      }\r\n    };\r\n  }, [hypes, activeHypeId]); // Added activeHypeId dependency to ensure state updates correctly\r\n\r\n  const toggleGlobalMute = () => {\r\n    setIsGlobalMuted((prev) => !prev);\r\n  };\r\n\r\n  return (\r\n    <div className=\"h-screen bg-white text-primary font-sans overflow-hidden flex flex-col items-center relative\">\r\n      {/* Top Bar (Floating) */}\r\n      <div className=\"absolute top-0 left-0 right-0 z-20 p-4 flex justify-between items-center bg-gradient-to-b from-white/80 to-transparent\">\r\n        <h1 className=\"text-xl font-bold\">Hypes</h1>\r\n        <Button\r\n          onClick={() => setShowUploadModal(true)}\r\n          size=\"icon\"\r\n          className=\"bg-primary/10 hover:bg-primary/20 text-primary backdrop-blur-md rounded-full w-10 h-10\"\r\n        >\r\n          <Upload className=\"w-5 h-5\" />\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Feed Container (Snap Scroll) */}\r\n      <div\r\n        ref={containerRef}\r\n        className=\"w-full max-w-md h-full overflow-y-scroll snap-y snap-mandatory scrollbar-hide pt-16\"\r\n      >\r\n        {hypes.length === 0 ? (\r\n          <div className=\"h-full flex flex-col items-center justify-center text-center p-8 opacity-60\">\r\n            <div className=\"w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center mb-4\">\r\n              <Upload className=\"w-10 h-10\" />\r\n            </div>\r\n            <h2 className=\"text-xl font-bold mb-2\">No Hypes Yet</h2>\r\n            <p className=\"mb-6\">Be the first to upload a hype!</p>\r\n            <Button\r\n              onClick={() => setShowUploadModal(true)}\r\n              className=\"bg-primary text-white hover:bg-primary/90 font-bold rounded-full px-8\"\r\n            >\r\n              Create Hype\r\n            </Button>\r\n          </div>\r\n        ) : (\r\n          hypes.map((item) => (\r\n            <div\r\n              key={item._id}\r\n              className=\"hype-card snap-center\"\r\n              data-id={item._id}\r\n            >\r\n              <ReelCard\r\n                id={item._id}\r\n                title={item.title}\r\n                author={item.author}\r\n                xp={item.xp}\r\n                mediaUrl={item.mediaUrl}\r\n                mediaType={item.mediaType}\r\n                initialLikes={item.likes}\r\n                initialIsLiked={item.isLiked}\r\n                initialComments={item.comments}\r\n                isActive={item._id === activeHypeId}\r\n                isGlobalMuted={isGlobalMuted}\r\n                onToggleGlobalMute={toggleGlobalMute}\r\n                creatorId={item.creatorId} // Pass creatorId\r\n              />\r\n            </div>\r\n          ))\r\n        )}\r\n      </div>\r\n\r\n      <UploadModal\r\n        isOpen={showUploadModal}\r\n        onClose={() => setShowUploadModal(false)}\r\n        onUploadSuccess={fetchHypes}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}